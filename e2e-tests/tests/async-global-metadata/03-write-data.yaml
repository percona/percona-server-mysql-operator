apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 10
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions
      haproxy_svc=$(get_haproxy_svc $(get_cluster_name))

      run_mysql_with_root \
          "CREATE DATABASE IF NOT EXISTS metadata;
           CREATE TABLE IF NOT EXISTS metadata.name (
             id VARCHAR(255) PRIMARY KEY
           );" \
          "-h $haproxy_svc"

      run_mysql_with_root \
          "INSERT INTO metadata.name (id) VALUES ('annotation1')
           ON DUPLICATE KEY UPDATE id='annotation1';
           INSERT INTO metadata.name (id) VALUES ('label1')
           ON DUPLICATE KEY UPDATE id='label1';" \
          "-h $haproxy_svc"
