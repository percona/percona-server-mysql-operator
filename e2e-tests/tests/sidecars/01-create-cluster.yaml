apiVersion: ps.percona.com/v2
kind: PerconaServerForMySQL
metadata:
  name: sidecar-test
spec:
  secretsName: sidecar-test-users
  sslSecretName: sidecar-test-ssl

  mysql:
    image: percona/percona-server:8.0
    imagePullPolicy: IfNotPresent

    size: 1

    volumeSpec:
      persistentVolumeClaim:
        resources:
          requests:
            storage: 1G

    sidecars:
    - name: noop-memory
      image: busybox
      command: ["sleep", "30d"]
      volumeMounts:
      - name: "memory-vol"
        mountPath: "/var/log/app/memory"
    - name: noop-pvc
      image: busybox
      command: ["sleep", "30d"]
      volumeMounts:
      - name: "pvc-vol"
        mountPath: "/var/log/app/pvc"
    sidecarVolumes:
    - name: "memory-vol"
      emptyDir:
        medium: "Memory"
    sidecarPVCs:
    - name: pvc-vol
      spec:
        resources:
          requests:
            storage: 1G
