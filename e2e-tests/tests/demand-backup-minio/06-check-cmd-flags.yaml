apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      restore_pod_name=$(kubectl get pod -n ${NAMESPACE} -l batch.kubernetes.io/job-name=xb-demand-backup-minio-minio-minio  -o name)

      xtrabackup_flag_count=$(kubectl logs -n ${NAMESPACE} $restore_pod_name | grep -- "--strict" | wc -l)
      if [ "$xtrabackup_flag_count" -eq 0 ]; then
        echo "custom flag --strict was provided to the restore but it's not mentioned in the logs"
        exit 1
      fi

