apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 10
commands:
  - script: |-
      set -o errexit
      set -o xtrace
      
      # Services and backup/restore related objects will persist annotations and labels
      for key in label1 label2 annotation1 annotation2; do
        if kubectl get deployment,statefulset,configmap,secret,pdb -A -o yaml -n "${NAMESPACE}" | grep -q "$key: $key"; then
          echo "'$key' still exists! Failing..."
          exit 1
        fi
      done
